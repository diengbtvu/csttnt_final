@model ClassificationRequest
@{
    ViewData["Title"] = "Ph√¢n lo·∫°i tin t·ª©c";
}

<div class="gradient-bg text-white py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 text-center">
                <h1 class="display-4 mb-3">
                    <i class="fas fa-brain me-3"></i>
                    Ph√¢n lo·∫°i tin t·ª©c ti·∫øng Vi·ªát
                </h1>
                <p class="lead mb-4">
                    S·ª≠ d·ª•ng thu·∫≠t to√°n Na√Øve Bayes ƒë·ªÉ t·ª± ƒë·ªông ph√¢n lo·∫°i b√†i b√°o th√†nh c√°c danh m·ª•c: 
                    Kinh doanh, Th·ªÉ thao, Gi·∫£i tr√≠, C√¥ng ngh·ªá, S·ª©c kh·ªèe, Gi√°o d·ª•c, Ch√≠nh tr·ªã
                </p>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg card-hover">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-edit me-2"></i>
                        Nh·∫≠p n·ªôi dung b√†i b√°o
                    </h4>
                </div>
                <div class="card-body">
                    <form asp-action="Classify" method="post">
                        <div class="mb-4">
                            <label asp-for="NewsText" class="form-label fw-bold">
                                <i class="fas fa-newspaper me-1"></i>
                                N·ªôi dung b√†i b√°o:
                            </label>
                            <textarea asp-for="NewsText" 
                                     class="form-control" 
                                     rows="10" 
                                     placeholder="D√°n ho·∫∑c nh·∫≠p n·ªôi dung b√†i b√°o c·∫ßn ph√¢n lo·∫°i v√†o ƒë√¢y...&#10;&#10;V√≠ d·ª•: &#10;- B√†i v·ªÅ c√¥ng ngh·ªá: 'C√¥ng ty Apple v·ª´a ra m·∫Øt iPhone m·ªõi v·ªõi c√¥ng ngh·ªá AI ti√™n ti·∫øn...'&#10;- B√†i v·ªÅ th·ªÉ thao: 'ƒê·ªôi tuy·ªÉn Vi·ªát Nam v·ª´a gi√†nh chi·∫øn th·∫Øng 2-1 tr∆∞·ªõc Th√°i Lan...'&#10;- B√†i v·ªÅ kinh doanh: 'Ch·ª©ng kho√°n Vi·ªát Nam tƒÉng m·∫°nh khi c√°c nh√† ƒë·∫ßu t∆∞ n∆∞·ªõc ngo√†i...'"></textarea>
                            <span asp-validation-for="NewsText" class="text-danger"></span>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-magic me-2"></i>
                                Ph√¢n lo·∫°i b√†i b√°o
                            </button>
                        </div>
                        
                        <!-- Ch·ªâ s·ª≠ d·ª•ng Naive Bayes thu·∫ßn t√∫y -->
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <div class="d-grid">
                                    <button type="button" class="btn btn-outline-success" id="analyzeNaiveBayesBtn">
                                        <i class="fas fa-brain me-2"></i>
                                        Xem chi ti·∫øt qu√° tr√¨nh Naive Bayes
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="d-grid">
                                    <button type="button" class="btn btn-outline-secondary" id="showModelInfoBtn">
                                        <i class="fas fa-info-circle me-2"></i>
                                        Th√¥ng tin Model
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- C√¥ng th·ª©c Naive Bayes - Hi·ªÉn th·ªã ngay tr√™n trang ch√≠nh -->
            <div class="card mt-4 border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-calculator me-2"></i>
                        C√¥ng th·ª©c To√°n h·ªçc Naive Bayes
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">
                                <i class="fas fa-formula me-1"></i>
                                C√¥ng th·ª©c t·ªïng qu√°t:
                            </h6>
                            <div class="bg-light p-3 mb-3 rounded border" style="font-family: 'Courier New', monospace;">
                                <div class="text-center">
                                    <strong style="font-size: 1.1em;">P(C|X) = P(C) √ó ‚àè P(X<sub>i</sub>|C)</strong>
                                </div>
                                <hr class="my-2">
                                <small class="text-muted">
                                    ‚Ä¢ <strong>P(C|X)</strong>: X√°c su·∫•t l·ªõp C cho vƒÉn b·∫£n X<br>
                                    ‚Ä¢ <strong>P(C)</strong>: X√°c su·∫•t ti√™n nghi·ªám c·ªßa l·ªõp C<br>
                                    ‚Ä¢ <strong>P(X<sub>i</sub>|C)</strong>: Likelihood c·ªßa ƒë·∫∑c tr∆∞ng X<sub>i</sub> v·ªõi l·ªõp C
                                </small>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6 class="text-success">
                                <i class="fas fa-chart-line me-1"></i>
                                D·∫°ng Log (th·ª±c t·∫ø s·ª≠ d·ª•ng):
                            </h6>
                            <div class="bg-light p-3 mb-3 rounded border" style="font-family: 'Courier New', monospace;">
                                <div class="text-center">
                                    <strong style="font-size: 1.1em;">log P(C|X) = log P(C) + Œ£ log P(X<sub>i</sub>|C)</strong>
                                </div>
                                <hr class="my-2">
                                <small class="text-muted">
                                    <strong>V·ªõi Gaussian Distribution:</strong><br>
                                    ‚Ä¢ P(X<sub>i</sub>|C) = (1/‚àö(2œÄœÉ¬≤)) √ó e<sup>-(X<sub>i</sub>-Œº)¬≤/(2œÉ¬≤)</sup><br>
                                    ‚Ä¢ Œº, œÉ¬≤: mean v√† variance t·ª´ training data
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-info mb-0">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <small>
                                    <i class="fas fa-lightbulb me-1 text-warning"></i>
                                    <strong>C√°ch ho·∫°t ƒë·ªông:</strong> H·ªá th·ªëng t√≠nh log probability cho t·ª´ng l·ªõp (Kinh doanh, Th·ªÉ thao, Gi·∫£i tr√≠, etc.) 
                                    r·ªìi ch·ªçn l·ªõp c√≥ gi√° tr·ªã cao nh·∫•t l√†m k·∫øt qu·∫£. Click <strong>"Xem chi ti·∫øt qu√° tr√¨nh Naive Bayes"</strong> ƒë·ªÉ xem t·ª´ng b∆∞·ªõc t√≠nh to√°n!
                                </small>
                            </div>
                            <div class="col-md-4 text-end">
                                <span class="badge bg-primary p-2">
                                    <i class="fas fa-brain me-1"></i>
                                    AI Classification
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng -->
            <div class="card mt-4 border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-question-circle me-2"></i>
                        H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">
                                <i class="fas fa-list me-1"></i>
                                C√°c danh m·ª•c ph√¢n lo·∫°i:
                            </h6>
                            <ul class="list-unstyled">
                                <li><span class="badge bg-primary me-2">Kinh doanh</span> T√†i ch√≠nh, ƒë·∫ßu t∆∞, th∆∞∆°ng m·∫°i</li>
                                <li><span class="badge bg-success me-2">Th·ªÉ thao</span> B√≥ng ƒë√°, tennis, Olympic</li>
                                <li><span class="badge bg-warning me-2">Gi·∫£i tr√≠</span> Phim ·∫£nh, √¢m nh·∫°c, sao</li>
                                <li><span class="badge bg-info me-2">C√¥ng ngh·ªá</span> AI, blockchain, ·ª©ng d·ª•ng</li>
                                <li><span class="badge bg-danger me-2">S·ª©c kh·ªèe</span> Y t·∫ø, b·ªánh t·∫≠t, thu·ªëc</li>
                                <li><span class="badge bg-secondary me-2">Gi√°o d·ª•c</span> Tr∆∞·ªùng h·ªçc, ƒë√†o t·∫°o</li>
                                <li><span class="badge bg-dark me-2">Ch√≠nh tr·ªã</span> Ch√≠nh ph·ªß, lu·∫≠t ph√°p</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6 class="fw-bold text-primary">
                                <i class="fas fa-lightbulb me-1"></i>
                                Tips ƒë·ªÉ c√≥ k·∫øt qu·∫£ t·ªët:
                            </h6>
                            <ul class="small">
                                <li>Nh·∫≠p √≠t nh·∫•t 500 - 2000 t·ª´</li>
                                <li>Bao g·ªìm ti√™u ƒë·ªÅ v√† n·ªôi dung ch√≠nh</li>
                                <li>Tr√°nh n·ªôi dung qu√° ng·∫Øn ho·∫∑c ch·ªâ c√≥ ti√™u ƒë·ªÅ</li>
                                <li>N·ªôi dung c√†ng chi ti·∫øt, k·∫øt qu·∫£ c√†ng ch√≠nh x√°c</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-resize textarea
        document.getElementById('NewsText').addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        // Character counter
        const textarea = document.querySelector('textarea[name="NewsText"]');
        const counter = document.createElement('small');
        counter.className = 'text-muted mt-1 d-block';
        textarea.parentNode.appendChild(counter);

        function updateCounter() {
            const length = textarea.value.length;
            counter.textContent = `${length} k√Ω t·ª±`;
            
            if (length < 10) {
                counter.className = 'text-danger mt-1 d-block';
            } else if (length < 50) {
                counter.className = 'text-warning mt-1 d-block';
            } else {
                counter.className = 'text-success mt-1 d-block';
            }
        }

        textarea.addEventListener('input', updateCounter);
        updateCounter();

        // X·ª≠ l√Ω ph√¢n t√≠ch Naive Bayes
        document.getElementById('analyzeNaiveBayesBtn').addEventListener('click', function() {
            const newsText = document.querySelector('textarea[name="NewsText"]').value;
            
            if (!newsText.trim()) {
                alert('Vui l√≤ng nh·∫≠p n·ªôi dung b√†i b√°o tr∆∞·ªõc khi ph√¢n t√≠ch!');
                return;
            }

            const btn = this;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ƒêang ph√¢n t√≠ch...';

            fetch('/Home/GetDetailedNaiveBayesAnalysis', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ 
                    text: newsText,
                    maxFeaturesToShow: 10,
                    showAllFeatures: false
                })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('API Response:', data);
                if (data.success && data.data) {
                    // Hi·ªÉn th·ªã k·∫øt qu·∫£ chi ti·∫øt tr√™n trang web
                    showDetailedAnalysis(data.data);
                } else {
                    alert('‚ùå ' + (data.message || 'Kh√¥ng th·ªÉ th·ª±c hi·ªán ph√¢n t√≠ch chi ti·∫øt'));
                }
            })
            .catch(error => {
                console.error('Detailed Error:', error);
                alert('‚ùå C√≥ l·ªói x·∫£y ra khi ph√¢n t√≠ch Naive Bayes: ' + error.message);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        });

        // Hi·ªÉn th·ªã k·∫øt qu·∫£ ph√¢n t√≠ch chi ti·∫øt
        function showDetailedAnalysis(analysisData) {
            // T·∫°o v√† hi·ªÉn th·ªã modal v·ªõi th√¥ng tin chi ti·∫øt
            const modal = createAnalysisModal(analysisData);
            document.body.appendChild(modal);
            
            const bootstrapModal = new bootstrap.Modal(modal);
            bootstrapModal.show();
            
            // X√≥a modal khi ƒë√≥ng
            modal.addEventListener('hidden.bs.modal', function () {
                document.body.removeChild(modal);
            });
            
            // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
            setTimeout(() => {
                alert('üß† Ph√¢n t√≠ch Naive Bayes chi ti·∫øt ƒë√£ ho√†n th√†nh!\n\n' +
                      'üìä K·∫øt qu·∫£ bao g·ªìm:\n' +
                      '- Th√¥ng tin model v√† x√°c su·∫•t ti√™n nghi·ªám\n' +
                      '- Qu√° tr√¨nh t√≠nh to√°n t·ª´ng b∆∞·ªõc\n' +
                      '- C√¥ng th·ª©c Gaussian cho t·ª´ng ƒë·∫∑c tr∆∞ng\n' +
                      '- Log probabilities v√† ranking\n\n' +
                      'üëÅÔ∏è Modal hi·ªÉn th·ªã k·∫øt qu·∫£ chi ti·∫øt ƒë√£ ƒë∆∞·ª£c m·ªü!');
            }, 500);
        }

        // T·∫°o modal cho k·∫øt qu·∫£ ph√¢n t√≠ch
        function createAnalysisModal(data) {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.id = 'naiveBayesModal';
            modal.tabIndex = -1;
            
            modal.innerHTML = `
                <div class="modal-dialog modal-xl modal-dialog-scrollable">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h4 class="modal-title">
                                <i class="fas fa-brain me-2"></i>
                                Ph√¢n t√≠ch chi ti·∫øt Naive Bayes
                            </h4>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            ${generateModalContent(data)}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            <button type="button" class="btn btn-primary" onclick="printAnalysis()">In k·∫øt qu·∫£</button>
                        </div>
                    </div>
                </div>
            `;
            
            return modal;
        }

        // T·∫°o n·ªôi dung modal
        function generateModalContent(data) {
            const nonZeroFeaturesHtml = data.nonZeroFeatures.slice(0, 10)
                .map(f => `<li><code>${f.name}</code>: ${f.value.toFixed(1)}</li>`)
                .join('');
                
            const classAnalysesHtml = data.classAnalyses
                .sort((a, b) => b.finalLogProbability - a.finalLogProbability)
                .map(classAnalysis => `
                    <div class="card mb-3 ${classAnalysis.isPredicted ? 'border-success' : ''}">
                        <div class="card-header ${classAnalysis.isPredicted ? 'bg-success text-white' : 'bg-light'}">
                            <h6 class="mb-0">
                                ${classAnalysis.isPredicted ? 'üèÜ ' : ''}
                                ${classAnalysis.className.toUpperCase()} 
                                <span class="badge ${classAnalysis.isPredicted ? 'bg-light text-success' : 'bg-secondary'} ms-2">
                                    #${classAnalysis.rank}
                                </span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <!-- C√¥ng th·ª©c t√≠nh chi ti·∫øt -->
                            <div class="alert alert-info mb-3">
                                <h6 class="mb-2"><i class="fas fa-formula me-2"></i>C√¥ng th·ª©c t√≠nh cho l·ªõp ${classAnalysis.className}:</h6>
                                <div style="font-family: 'Courier New', monospace; font-size: 0.9em;">
                                    <strong>log P(${classAnalysis.className}|X) = log P(${classAnalysis.className}) + Œ£ log P(Xi|${classAnalysis.className})</strong><br>
                                    <span class="text-muted">= ${classAnalysis.logPriorProbability.toFixed(6)} + (${classAnalysis.totalLogLikelihood.toFixed(6)})</span><br>
                                    <span class="text-success"><strong>= ${classAnalysis.finalLogProbability.toFixed(6)}</strong></span>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <strong>1. X√°c su·∫•t ti√™n nghi·ªám:</strong><br>
                                    <small>P(${classAnalysis.className}) = ${classAnalysis.priorProbability.toFixed(6)}</small><br>
                                    <small>Log P(${classAnalysis.className}) = ${classAnalysis.logPriorProbability.toFixed(6)}</small>
                                </div>
                                <div class="col-md-4">
                                    <strong>2. T·ªïng Log Likelihood:</strong><br>
                                    <small>Œ£ log P(Xi|${classAnalysis.className}) = ${classAnalysis.totalLogLikelihood.toFixed(6)}</small><br>
                                    <small>(t·ª´ ${classAnalysis.features.length} ƒë·∫∑c tr∆∞ng c√≥ gi√° tr·ªã > 0)</small>
                                </div>
                                <div class="col-md-4">
                                    <strong>3. K·∫øt qu·∫£ cu·ªëi:</strong><br>
                                    <small>log P(${classAnalysis.className}|X) = ${classAnalysis.finalLogProbability.toFixed(6)}</small><br>
                                    <small>${classAnalysis.isPredicted ? 'üéØ <span class="text-success fw-bold">WINNER</span>' : ''}</small>
                                </div>
                            </div>
                            
                            <!-- Chi ti·∫øt Gaussian calculation cho top features -->
                            ${classAnalysis.features.length > 0 ? `
                            <hr>
                            <h6 class="mt-3"><i class="fas fa-chart-line me-2"></i>Chi ti·∫øt t√≠nh Gaussian cho ${Math.min(3, classAnalysis.features.length)} ƒë·∫∑c tr∆∞ng h√†ng ƒë·∫ßu:</h6>
                            <div class="row">
                                ${classAnalysis.features.slice(0, 3).map(feature => `
                                    <div class="col-md-4 mb-2">
                                        <div class="border p-2 rounded">
                                            <strong>${feature.featureName}</strong> = ${feature.featureValue}<br>
                                            <small class="text-muted">Œº = ${feature.mean.toFixed(3)}, œÉ¬≤ = ${feature.variance.toFixed(3)}</small><br>
                                            <div style="font-size: 0.8em; font-family: monospace;">
                                                P(${feature.featureValue}|${classAnalysis.className}) = ${feature.gaussianProbability.toExponential(3)}<br>
                                                log P = ${feature.logLikelihood.toFixed(6)}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            
            return `
                <!-- C√¥ng th·ª©c Naive Bayes -->
                <div class="card mb-3 border-primary">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="fas fa-calculator me-2"></i>C√¥ng th·ª©c Naive Bayes</h6>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">1. C√¥ng th·ª©c t·ªïng qu√°t:</h6>
                                <div class="bg-light p-3 mb-3" style="font-family: 'Courier New', monospace;">
                                    <strong>P(C|X) = P(C) √ó ‚àè P(Xi|C)</strong><br>
                                    <small class="text-muted">Trong ƒë√≥:</small><br>
                                    <small>‚Ä¢ P(C|X): X√°c su·∫•t l·ªõp C cho vƒÉn b·∫£n X</small><br>
                                    <small>‚Ä¢ P(C): X√°c su·∫•t ti√™n nghi·ªám c·ªßa l·ªõp C</small><br>
                                    <small>‚Ä¢ P(Xi|C): Likelihood c·ªßa ƒë·∫∑c tr∆∞ng Xi v·ªõi l·ªõp C</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">2. D·∫°ng Logarithm (s·ª≠ d·ª•ng):</h6>
                                <div class="bg-light p-3 mb-3" style="font-family: 'Courier New', monospace;">
                                    <strong>log P(C|X) = log P(C) + Œ£ log P(Xi|C)</strong><br>
                                    <small class="text-muted">V·ªõi Gaussian Distribution:</small><br>
                                    <small>‚Ä¢ P(Xi|C) = (1/‚àö(2œÄœÉ¬≤)) √ó e^(-(Xi-Œº)¬≤/(2œÉ¬≤))</small><br>
                                    <small>‚Ä¢ Œº, œÉ¬≤: mean v√† variance t·ª´ training data</small>
                                </div>
                            </div>
                        </div>
                        <div class="alert alert-warning mb-0">
                            <small><i class="fas fa-lightbulb me-1"></i>
                            <strong>L∆∞u √Ω:</strong> S·ª≠ d·ª•ng log ƒë·ªÉ tr√°nh underflow khi nh√¢n nhi·ªÅu x√°c su·∫•t nh·ªè. 
                            L·ªõp c√≥ log probability cao nh·∫•t s·∫Ω ƒë∆∞·ª£c ch·ªçn l√†m k·∫øt qu·∫£ d·ª± ƒëo√°n.
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin t·ªïng quan -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Th√¥ng tin Model</h6>
                            <ul class="mb-0 small">
                                <li>T·ªïng m·∫´u training: ${data.model.totalSamples}</li>
                                <li>S·ªë l·ªõp: ${data.model.totalClasses}</li>
                                <li>S·ªë ƒë·∫∑c tr∆∞ng: ${data.model.totalFeatures}</li>
                                <li>ƒê·∫∑c tr∆∞ng c√≥ gi√° tr·ªã > 0: ${data.significantFeatures}</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="alert alert-${data.isCorrect ? 'success' : 'warning'}">
                            <h6><i class="fas fa-${data.isCorrect ? 'check-circle' : 'exclamation-triangle'} me-2"></i>K·∫øt qu·∫£ d·ª± ƒëo√°n</h6>
                            <ul class="mb-0 small">
                                <li><strong>L·ªõp d·ª± ƒëo√°n:</strong> ${data.predictedClass}</li>
                                <li><strong>Log Probability:</strong> ${data.predictedLogProbability.toFixed(6)}</li>
                                <li><strong>Tr·∫°ng th√°i:</strong> ${data.isCorrect ? 'Ch√≠nh x√°c' : 'C·∫ßn xem x√©t'}</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- ƒê·∫∑c tr∆∞ng c√≥ gi√° tr·ªã > 0 -->
                <div class="card mb-3">
                    <div class="card-header bg-success text-white">
                        <h6 class="mb-0"><i class="fas fa-list me-2"></i>ƒê·∫∑c tr∆∞ng c√≥ gi√° tr·ªã > 0 (10 ƒë·∫ßu ti√™n)</h6>
                    </div>
                    <div class="card-body">
                        <ul class="row small">${nonZeroFeaturesHtml}</ul>
                    </div>
                </div>

                <!-- Qu√° tr√¨nh t√≠nh to√°n cho t·ª´ng l·ªõp -->
                <div class="card mb-3">
                    <div class="card-header bg-warning text-dark">
                        <h6 class="mb-0"><i class="fas fa-calculator me-2"></i>Qu√° tr√¨nh t√≠nh to√°n cho t·ª´ng l·ªõp</h6>
                    </div>
                    <div class="card-body">
                        ${classAnalysesHtml}
                    </div>
                </div>

                <!-- B·∫£ng k·∫øt qu·∫£ cu·ªëi c√πng -->
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h6 class="mb-0"><i class="fas fa-flag-checkered me-2"></i>B·∫£ng x·∫øp h·∫°ng cu·ªëi c√πng</h6>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm table-striped">
                                <thead>
                                    <tr><th>Rank</th><th>L·ªõp</th><th>Log Probability</th><th>K·∫øt qu·∫£</th></tr>
                                </thead>
                                <tbody>
                                    ${data.classAnalyses
                                        .sort((a, b) => b.finalLogProbability - a.finalLogProbability)
                                        .map(c => `
                                            <tr class="${c.isPredicted ? 'table-success' : ''}">
                                                <td><strong>#${c.rank}</strong></td>
                                                <td>${c.className} ${c.isPredicted ? 'üèÜ' : ''}</td>
                                                <td><code>${c.finalLogProbability.toFixed(6)}</code></td>
                                                <td>${c.isPredicted ? '<span class="badge bg-success">WINNER</span>' : ''}</td>
                                            </tr>
                                        `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        // In k·∫øt qu·∫£
        function printAnalysis() {
            window.print();
        }

        // X·ª≠ l√Ω hi·ªÉn th·ªã th√¥ng tin model
        document.getElementById('showModelInfoBtn').addEventListener('click', function() {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ƒêang t·∫£i...';

            fetch('/Home/ShowModelInfo', {
                method: 'GET',
                headers: {
                    'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]')?.value || ''
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('‚ÑπÔ∏è ' + data.message + '\n\nüìä Th√¥ng tin Model Naive Bayes:\n- S·ªë l∆∞·ª£ng l·ªõp v√† ƒë·∫∑c tr∆∞ng\n- X√°c su·∫•t ti√™n nghi·ªám P(C)\n- Th·ªëng k√™ ƒë·∫∑c tr∆∞ng (mean, variance)\n- C√°c th√¥ng s·ªë ph√¢n ph·ªëi Gaussian\n\nüñ•Ô∏è Vui l√≤ng ki·ªÉm tra console c·ªßa server ƒë·ªÉ xem chi ti·∫øt!');
                } else {
                    alert('‚ùå ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('‚ùå C√≥ l·ªói x·∫£y ra khi l·∫•y th√¥ng tin model!');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = originalText;
            });
        });
    </script>
}
